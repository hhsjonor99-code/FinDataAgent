# 敏捷看板记录

## Sprint0
    看板制定时间：12月19日晚9：00
    迭代目标：最小可行性框架，实现“自然语言 -> 知识检索 -> 代码生成 -> 执行 -> 产出文件”的最小用例实现，要求具备良好的可拓展性
            使用包含"知识库","Agent引擎","读写跑以及画图工具","工作空间"四个模块的结构

    完整项目代办：
        
        1.验收Sprint0后设计并完成相关优化
        2.增加知识库条目，以支持更加丰富多样化的内容
        3.通过tkinter快速构建简单使用的用户界面

### 本次Sprint待办
    1.基础文件夹结构建立
    2.获取 Tushare & DS 密钥
    3.编写Agent引擎，包括核心prompt设计等
    4.在工具模块中完成code_excuter.py以及最小用例实现所需的绘图函数
    5.为知识库添加为实现最小用例所需的知识条目
    6.集成以上的功能模块，跑通工作流

### 本次Sprint结算
    结算时间： 12月20日上午9：00

#### 目前代码结构以及功能
    - 项目结构：`core/` `tools/` `knowledge_base/` `workspace/` `gui/`
    - 核心能力：自然语言意图解析 → 加载知识库 → LLM 生成 Python 脚本 → 本地执行 → 输出结果路径
    - 知识库：
        - `tushare_schema.json` 定义 `tushare.daily` 的函数名、参数与示例
        - `tool_docs.json` 定义 `plot_line_chart` 的函数签名与示例
    - 工具层：
        - `code_executor.py` 将生成代码写入 `workspace/temp_scripts/` 并执行，返回 stdout
        - `plot_utils.py` 提供折线图绘制与保存
        - `tushare_api.py` 统一初始化并封装数据获取与导出（后备使用）
    - Agent 引擎：
        - `run_min_workflow(intent)` 负责整合知识库与 Prompt，调用 DeepSeek，并执行生成脚本
        - `knowledge_manager.py` 负责解析意图，但目前采用硬编码方式
        - Prompt 强化：明确通过 `dotenv + os.getenv('TUSHARE_TOKEN')` 初始化 Token，要求只打印最终文件路径
    - GUI：
        - `main.py` 提供简易 Tkinter 界面，输入自然语言一键执行并展示日志
    - 测试用例：
        - `min_test.py` 包含 Excel 导出与绘图两类场景测试
    

#### 接下来的项目整体代办

    - core/knowlegde_manager.py
        - 目前采用硬编码方式进行意图解析
        - 需要使用deepseek的api进行意图解析，以支持更加复杂的意图
        - 该文件命名有语法错误，修正为 `knowledge_manager.py` 并在其它各个地方对应修改

    - run_min_workflow 优化，要求内部包含以下逻辑：
        - 运行脚本前清除 `workspace/temp_scripts/` 目录下历史脚本（仅保留最新一次，避免干扰）
        - 保留 `workspace/exports/` 历史产物，避免误删；可按日期分目录或追加 `_{timestamp}` 做留存
        -run_min_workflow函数名称改为agent_workflow,在各处的调用都需要对应修改

    - 稳健性：统一脚本初始化模板片段（Token、排序、路径打印），减少 LLM 偏差   

    - 规范workspace中临时文件的命名规范，避免冲突
        - `workspace/temp_scripts/` 中脚本命名为 `agent_exec.py`
        - `workspace/exports/` 中文件命名为 `{ts_code}_{start_date}_{end_date}{ext}`，必要时追加 `_{timestamp}` 保证唯一性（如并发或重复请求）

    - 知识库扩充：增加更多 Tushare 接口条目与丰富的绘图函数（K线、子图、多轴）
    - GUI 体验：增加进度提示、错误详情与“打开文件夹”入口
    - 检索增强：将“全量投喂”改为 Top-K 检索（关键词过滤 → 向量检索）
    


## Sprint1
    看板制定时间：12月20日上午11：00
    迭代目标：优化工作流框架
### 本次Sprint待办

    - core/knowlegde_manager.py （优先级最高！）
        - 目前采用硬编码方式进行意图解析
        - 需要使用deepseek的api进行意图解析，以支持更加复杂的意图
        - 该文件命名有语法错误，修正为 `knowledge_manager.py` 并在其它各个地方对应修改

    - run_min_workflow 优化，要求内部包含以下逻辑：
        - 运行脚本前清除 `workspace/temp_scripts/` 目录下历史脚本（仅保留最新一次，避免干扰）
        - 保留 `workspace/exports/` 历史产物，避免误删；可按日期分目录或追加 `_{timestamp}` 做留存
        -run_min_workflow函数名称改为agent_workflow,在各处的调用都需要对应修改

    - 稳健性：统一脚本初始化模板片段（Token、排序、路径打印），减少 LLM 偏差   

### 本次Sprint结算
    constructing
