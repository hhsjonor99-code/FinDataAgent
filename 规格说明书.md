# 已弃用
# 软件规格说明书 (SRS)：FinData-Agent 智能经济分析助手

**项目名称**：FinData-Agent  
**课程名称**：软件过程与项目管理  
**技术架构**：LangChain + DeepSeek + Tushare + Tkinter  
**文档版本**：V1.0 (MVP版)

---

## 1. 引言 (Introduction)

### 1.1 项目背景
在金融分析领域，获取结构化数据并进行可视化通常需要用户具备编程能力（如 Python/Pandas）。本项目旨在开发一个基于大语言模型（LLM）的智能 Agent，降低数据分析门槛，使用户通过自然语言即可完成“数据抓取-清洗-存储-可视化”的全流程。

### 1.2 目标用户
*   缺乏编程基础的金融初学者。
*   需要快速获取特定股票/经济指标趋势的分析人员。

---

## 2. 总体设计 (General Design)

### 2.1 核心组件定义
1.  **Agent (核心大脑)**：基于 LangChain 框架封装的 ReAct 决策引擎，调用 DeepSeek-V3 模型。
2.  **Local Knowledge Base (知识库)**：结构化的 JSON/YAML 文件，存储 Tushare 接口文档及自定义绘图函数的 Metadata（参数、功能、示例）。
3.  **Tools (工具集)**：
    *   **Retrieval Tool**：从知识库检索相关的函数定义。
    *   **Code Generator**：生成符合逻辑的 Python 脚本。
    *   **Python Executor**：自动化运行脚本并捕获输出/异常。
4.  **GUI (用户界面)**：使用 Tkinter 构建的桌面交互窗口。

### 2.2 工作流程 (Workflow)
1.  **意图识别**：用户输入指令（如“画出平安银行2023至今的收盘价折线图”）。
2.  **知识检索**：Agent 调用工具查询知识库，获取 `ts.pro_api().daily` 接口及 `draw_line_chart` 函数的参数规范。
3.  **代码构建**：Agent 编写包含 API Token 初始化、数据获取、Excel 保存、Matplotlib 绘图逻辑的 Python 代码。
4.  **自动化执行**：系统将代码写入临时文件并运行，将结果保存至预设路径。
5.  **结果反馈**：GUI 显示任务执行状态，并自动弹出生成的图表或保存路径。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 数据采集功能 (Data Collection)
*   **接口对接**：支持 Tushare Pro 提供的标准股票/经济数据接口。
*   **参数映射**：Agent 需能自动将自然语言中的日期（如“2023年”）转换为接口要求的格式（`20230101`）。
*   **文件存储**：自动将抓取的 `DataFrame` 数据导出为 `.xlsx` 格式，并存放在指定文件夹（如 `/workspace/exports/`）。

### 3.2 数据可视化功能 (Data Visualization)
*   **图表生成**：支持生成折线图（Line Chart），后续可扩展 K 线图、柱状图。
*   **样式控制**：图表需包含正确的标题、坐标轴标签及中文支持。
*   **本地固化**：图片保存为 `.png` 或 `.jpg` 格式。

### 3.3 知识库管理功能 (Knowledge Base Management)
*   **元数据存储**：
    *   函数名（Function Name）
    *   必选参数与可选参数（Arguments）
    *   返回值说明（Return Value）
    *   示例代码片段（Code Snippet）

---

## 4. 非功能需求 (Non-functional Requirements)

### 4.1 可靠性与安全性
*   **代码沙箱**：Executor 在执行代码时需进行基础的 Try-Except 捕获，防止脚本崩溃导致主程序退出。
*   **异常处理**：若 LLM 生成的代码报错，系统应能捕获错误并反馈给 LLM 进行一次自我修复（Self-healing）。

### 4.2 性能需求
*   **响应时间**：LLM 推理时间应控制在 5-15 秒内，GUI 需在加载期间提供 Loading 提示，防止界面假死。

### 4.3 配置化管理
*   **路径配置**：Excel 和图片的保存根目录需在配置文件（`.env` 或 `config.py`）中可自定义。
*   **密钥管理**：DeepSeek API Key 和 Tushare Token 需加密存储或通过环境变量读取。

---

## 5. 接口规范 (Interface Specification)

### 5.1 知识库条目示例 (JSON)
```json
{
  "function_name": "tushare.daily",
  "description": "获取股票日线行情",
  "parameters": {
    "ts_code": "股票代码，如 000001.SZ",
    "start_date": "开始日期 YYYYMMDD",
    "end_date": "结束日期 YYYYMMDD"
  },
  "required_imports": ["import tushare as ts"]
}
```

### 5.2 绘图工具接口
*   `plot_line_chart(df, x_col, y_col, title, save_path)`

---

## 6. 项目风险与约束 (Risks & Constraints)

1.  **Tushare 权限限制**：用户需拥有足够的积分（Token）才能访问特定接口。
2.  **LLM 幻觉**：LLM 可能会生成错误的参数名称，需通过 Prompt Engineering 强化对知识库 Schema 的遵守。
3.  **环境依赖**：运行环境需提前安装 `pandas`, `matplotlib`, `tushare`, `openpyxl` 等库。

---

## 7. 软件过程管理说明 (Process Management - 针对课程)

*   **开发模型**：采用增量模型（Incremental Model）。第一增量实现 CLI 下的数据抓取；第二增量实现 GUI 交互；第三增量完善代码执行的异常处理。
*   **质量保证**：通过 Prompt Unit Testing（针对不同指令测试 LLM 代码生成的准确率）来保证系统核心逻辑。
*   **配置管理**：使用 Git 进行版本控制，确保代码与知识库 JSON 同步更新。

---

### **该文档在作业中的使用建议：**
1.  **图表补充**：在提交的作业中，建议配套画出**系统架构图**和**顺序图（Sequence Diagram）**。
2.  **WBS 挂钩**：在项目管理部分，将此 SRS 中的功能拆解为 WBS（工作分解结构），展示你如何分配开发任务。
3.  **MVP 演示**：演示时重点突出“自然语言 -> 自动写代码 -> 自动跑代码 -> 出 Excel 和图”的闭环，这是 Agent 的核心价值。